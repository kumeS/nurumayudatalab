<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>体調から栄養素を把握するAIチェッカー</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
        }

        h1 {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 8px;
            font-weight: 700;
            line-height: 1.3;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .main-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.2rem;
            color: #34495e;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e8f4f8;
            text-align: center;
        }

        .symptoms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .symptom-category {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 18px;
        }

        .category-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 1.0rem;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }

        .symptom-item {
            display: block;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 15px 12px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            background: #ffffff;
            text-align: center;
            font-weight: 500;
            user-select: none;
            font-size: 0.95rem;
            line-height: 1.3;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .symptom-item:hover {
            background: #e3f2fd;
            border-color: #90caf9;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .symptom-item.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .symptom-item.selected:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .button-container {
            text-align: center;
            margin: 30px 0;
        }

        .analyze-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 35px;
            font-size: 1.0rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            min-height: 56px;
            min-width: 200px;
            font-weight: 600;
        }

        .analyze-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .analyze-button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .result-container {
            display: none;
            background: #f0f8ff;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border: 2px solid #e3f2fd;
        }

        .result-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .result-content {
            white-space: pre-wrap;
            line-height: 1.8;
            color: #34495e;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .api-settings {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 25px;
        }

        .api-input {
            width: 100%;
            padding: 14px 12px;
            margin-top: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
            min-height: 48px;
        }

        .warning {
            color: #856404;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        /* タブレット対応 */
        @media (max-width: 1024px) {
            .symptoms-grid {
                grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
                gap: 15px;
            }
        }

        /* モバイル対応 */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.5rem;
                margin-bottom: 6px;
            }
            
            .subtitle {
                font-size: 0.9rem;
            }
            
            .main-content {
                padding: 18px;
                border-radius: 12px;
            }
            
            .symptoms-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-bottom: 20px;
            }

            .symptom-category {
                padding: 15px;
            }

            .category-title {
                font-size: 0.95rem;
                margin-bottom: 10px;
            }

            .symptom-item {
                margin: 8px 0;
                padding: 16px 10px;
                font-size: 0.9rem;
                min-height: 52px;
            }

            .section-title {
                font-size: 1.1rem;
                margin-bottom: 12px;
            }

            .analyze-button {
                padding: 16px 30px;
                font-size: 0.95rem;
                min-width: 180px;
                min-height: 52px;
            }

            .api-input {
                padding: 16px 12px;
                font-size: 1rem;
                min-height: 52px;
            }

            .result-container {
                padding: 20px;
            }

            .result-content {
                font-size: 0.9rem;
                line-height: 1.6;
            }
        }

        /* 小さなモバイルデバイス対応 */
        @media (max-width: 480px) {
            .container {
                padding: 8px;
            }
            
            h1 {
                font-size: 1.3rem;
            }
            
            .main-content {
                padding: 15px;
            }

            .symptom-item {
                font-size: 0.85rem;
                padding: 14px 8px;
            }

            .analyze-button {
                padding: 14px 25px;
                font-size: 0.9rem;
                min-width: 160px;
            }

            .api-settings {
                padding: 15px;
            }
        }

        /* ホバー効果をタッチデバイスで無効化 */
        @media (hover: none) and (pointer: coarse) {
            .symptom-item:hover {
                background: #ffffff;
                border-color: #e0e0e0;
                transform: none;
                box-shadow: none;
            }

            .symptom-item.selected:hover {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                transform: none;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            }

            .analyze-button:hover {
                transform: none;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>体調から栄養素を把握するAIチェッカー</h1>
            <p class="subtitle">あなたの体調から不足している可能性のある栄養素を分析します</p>
        </header>

        <div class="main-content">
            <div class="api-settings">
                <div class="section-title">APIキー設定</div>
                <input type="password" id="apiKey" class="api-input" placeholder="OpenAI APIキーを入力してください">
                <p class="warning">※ APIキーはブラウザに保存されず、通信は暗号化されます</p>
            </div>

            <div class="section-title">現在の体調について教えてください</div>
            
            <div class="symptoms-grid">
                <div class="symptom-category">
                    <div class="category-title">全身症状</div>
                    <div class="symptom-item" data-value="疲れやすい">
                        疲れやすい
                    </div>
                    <div class="symptom-item" data-value="だるさが続く">
                        だるさが続く
                    </div>
                    <div class="symptom-item" data-value="階段の上り下りが辛い">
                        階段の上り下りが辛い
                    </div>
                    <div class="symptom-item" data-value="疲労回復が遅い">
                        疲労回復が遅い
                    </div>
                    <div class="symptom-item" data-value="冷え性">
                        冷え性
                    </div>
                </div>

                <div class="symptom-category">
                    <div class="category-title">代謝・体重</div>
                    <div class="symptom-item" data-value="最近太りやすい">
                        最近太りやすい
                    </div>
                    <div class="symptom-item" data-value="代謝が落ちた">
                        代謝が落ちた
                    </div>
                    <div class="symptom-item" data-value="食欲不振">
                        食欲不振
                    </div>
                    <div class="symptom-item" data-value="お腹が張りやすい">
                        お腹が張りやすい
                    </div>
                    <div class="symptom-item" data-value="便秘気味">
                        便秘気味
                    </div>
                </div>

                <div class="symptom-category">
                    <div class="category-title">睡眠・精神</div>
                    <div class="symptom-item" data-value="寝つきが悪い">
                        寝つきが悪い
                    </div>
                    <div class="symptom-item" data-value="眠りが浅い">
                        眠りが浅い
                    </div>
                    <div class="symptom-item" data-value="イライラしやすい">
                        イライラしやすい
                    </div>
                    <div class="symptom-item" data-value="集中力が続かない">
                        集中力が続かない
                    </div>
                    <div class="symptom-item" data-value="気分の落ち込み">
                        気分の落ち込み
                    </div>
                </div>

                <div class="symptom-category">
                    <div class="category-title">皮膚・髪・爪</div>
                    <div class="symptom-item" data-value="肌の乾燥">
                        肌の乾燥
                    </div>
                    <div class="symptom-item" data-value="肌荒れしやすい">
                        肌荒れしやすい
                    </div>
                    <div class="symptom-item" data-value="髪の毛が抜けやすい">
                        髪の毛が抜けやすい
                    </div>
                    <div class="symptom-item" data-value="爪が割れやすい">
                        爪が割れやすい
                    </div>
                    <div class="symptom-item" data-value="傷の治りが遅い">
                        傷の治りが遅い
                    </div>
                </div>

                <div class="symptom-category">
                    <div class="category-title">目・口</div>
                    <div class="symptom-item" data-value="目の疲れ">
                        目の疲れ
                    </div>
                    <div class="symptom-item" data-value="目の乾燥">
                        目の乾燥
                    </div>
                    <div class="symptom-item" data-value="口内炎ができやすい">
                        口内炎ができやすい
                    </div>
                    <div class="symptom-item" data-value="口の渇き">
                        口の渇き
                    </div>
                    <div class="symptom-item" data-value="味覚の変化">
                        味覚の変化
                    </div>
                </div>

                <div class="symptom-category">
                    <div class="category-title">筋肉・関節</div>
                    <div class="symptom-item" data-value="筋肉がつりやすい">
                        筋肉がつりやすい
                    </div>
                    <div class="symptom-item" data-value="関節の痛み">
                        関節の痛み
                    </div>
                    <div class="symptom-item" data-value="筋力低下">
                        筋力低下
                    </div>
                    <div class="symptom-item" data-value="体の硬さ・こわばり">
                        体の硬さ・こわばり
                    </div>
                    <div class="symptom-item" data-value="肩こり・腰痛">
                        肩こり・腰痛
                    </div>
                </div>

                <div class="symptom-category">
                    <div class="category-title">その他</div>
                    <div class="symptom-item" data-value="頭痛がよくある">
                        頭痛がよくある
                    </div>
                    <div class="symptom-item" data-value="めまいがする">
                        めまいがする
                    </div>
                    <div class="symptom-item" data-value="風邪をひきやすい">
                        風邪をひきやすい
                    </div>
                    <div class="symptom-item" data-value="むくみやすい">
                        むくみやすい
                    </div>
                    <div class="symptom-item" data-value="動悸がする">
                        動悸がする
                    </div>
                </div>
            </div>

            <div class="button-container">
                <button class="analyze-button" onclick="analyzeSymptoms()">栄養素を分析する</button>
            </div>

            <div class="loading">
                <div class="loading-spinner"></div>
                <p>分析中です...</p>
            </div>

            <div class="result-container">
                <h2 class="result-title">分析結果</h2>
                <div class="result-content"></div>
            </div>
        </div>
    </div>

    <script>
        // 禁止ワードリスト
        const prohibitedWords = [
            // 薬事法関連
            '治る', '治す', '治療', '完治', '即効', '特効', '万能',
            '医薬品', '処方箋', '診断', '病名',
            // 効果効能の誇張
            '確実に', '必ず', '絶対', '100%', '劇的に',
            '痩せる', 'ダイエット効果', '脂肪燃焼',
            '精力増強', '性機能向上', 'ED改善',
            // 商品名・メーカー名（例）
            'サプリメント名', '製薬会社名',
            // その他
            '癌', 'がん', '腫瘍', '重病'
        ];

        // 禁止ワードチェック関数
        function checkProhibitedWords(text) {
            const foundWords = [];
            prohibitedWords.forEach(word => {
                if (text.includes(word)) {
                    foundWords.push(word);
                }
            });
            return foundWords;
        }

        // システムプロンプト
        const systemPrompt = `あなたは栄養学と東洋医学の知識を持つ健康アドバイザーです。
ユーザーの体調症状から、不足している可能性のある栄養素やビタミンを分析し、適切な食材を提案してください。

以下の点に注意してください：
1. 医療診断や治療に関する発言は避ける
2. 薬事法に抵触する表現を使わない
3. 商品名やメーカー名は出さない
4. 効果効能を誇張しない
5. あくまで一般的な栄養学的アドバイスに留める
6. 東洋医学の「気・血・水」の考え方も参考にする
7. 食材の提案は身近で入手しやすいものを中心にする

回答は以下の形式で：
【不足している可能性のある栄養素】
- 栄養素名：理由と説明

【おすすめの食材】
- 食材名：含まれる栄養素と期待される働き

【生活習慣のアドバイス】
- 具体的なアドバイス

※注意：これは一般的な栄養学的アドバイスです。症状が続く場合は医療機関を受診してください。`;

        async function analyzeSymptoms() {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                alert('APIキーを入力してください');
                return;
            }

            // チェックされた症状を取得
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            if (checkboxes.length === 0) {
                alert('少なくとも1つの症状を選択してください');
                return;
            }

            const symptoms = Array.from(checkboxes).map(cb => cb.value);
            const symptomText = symptoms.join('、');

            // UI更新
            document.querySelector('.analyze-button').disabled = true;
            document.querySelector('.loading').style.display = 'block';
            document.querySelector('.result-container').style.display = 'none';

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: `以下の症状があります：${symptomText}\n\nこれらの症状から考えられる栄養素の不足と、おすすめの食材を教えてください。` }
                        ],
                        temperature: 0.7,
                        max_tokens: 1000
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                const result = data.choices[0].message.content;

                // 禁止ワードチェック
                const foundProhibitedWords = checkProhibitedWords(result);
                if (foundProhibitedWords.length > 0) {
                    console.warn('禁止ワードが検出されました:', foundProhibitedWords);
                    // 実際の実装では、結果をフィルタリングするか再生成する
                }

                // 結果表示
                document.querySelector('.result-content').textContent = result;
                document.querySelector('.result-container').style.display = 'block';

            } catch (error) {
                console.error('Error:', error);
                alert('分析中にエラーが発生しました。APIキーを確認してください。');
            } finally {
                document.querySelector('.analyze-button').disabled = false;
                document.querySelector('.loading').style.display = 'none';
            }
        }

        // エンターキーでの誤送信を防ぐ
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.target.tagName !== 'BUTTON') {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>