<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>体調から栄養素を把握するAIチェッカー</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
        }

        h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .main-content {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 40px;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5rem;
            color: #34495e;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e8f4f8;
        }

        .symptoms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .symptom-category {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .category-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .symptom-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 5px;
            border-radius: 5px;
        }

        .symptom-item:hover {
            background: #e3f2fd;
        }

        .symptom-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 10px;
            cursor: pointer;
        }

        .symptom-item label {
            cursor: pointer;
            flex: 1;
        }

        .button-container {
            text-align: center;
            margin: 30px 0;
        }

        .analyze-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .analyze-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .analyze-button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .result-container {
            display: none;
            background: #f0f8ff;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border: 2px solid #e3f2fd;
        }

        .result-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .result-content {
            white-space: pre-wrap;
            line-height: 1.8;
            color: #34495e;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .api-settings {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .api-input {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .warning {
            color: #856404;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .symptoms-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>体調から栄養素を把握するAIチェッカー</h1>
            <p class="subtitle">あなたの体調から不足している可能性のある栄養素を分析します</p>
        </header>

        <div class="main-content">
            <div class="api-settings">
                <div class="section-title">APIキー設定</div>
                <input type="password" id="apiKey" class="api-input" placeholder="OpenAI APIキーを入力してください">
                <p class="warning">※ APIキーはブラウザに保存されず、通信は暗号化されます</p>
            </div>

            <div class="section-title">現在の体調について教えてください</div>
            
            <div class="symptoms-grid">
                <div class="symptom-category">
                    <div class="category-title">全身症状</div>
                    <div class="symptom-item">
                        <input type="checkbox" id="fatigue" value="疲れやすい">
                        <label for="fatigue">疲れやすい</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="weakness" value="だるさが続く">
                        <label for="weakness">だるさが続く</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="stairs" value="階段の上り下りが辛い">
                        <label for="stairs">階段の上り下りが辛い</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="recovery" value="疲労回復が遅い">
                        <label for="recovery">疲労回復が遅い</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="cold" value="冷え性">
                        <label for="cold">冷え性</label>
                    </div>
                </div>

                <div class="symptom-category">
                    <div class="category-title">代謝・体重</div>
                    <div class="symptom-item">
                        <input type="checkbox" id="weight_gain" value="最近太りやすい">
                        <label for="weight_gain">最近太りやすい</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="metabolism" value="代謝が落ちた">
                        <label for="metabolism">代謝が落ちた</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="appetite" value="食欲不振">
                        <label for="appetite">食欲不振</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="bloating" value="お腹が張りやすい">
                        <label for="bloating">お腹が張りやすい</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="constipation" value="便秘気味">
                        <label for="constipation">便秘気味</label>
                    </div>
                </div>

                <div class="symptom-category">
                    <div class="category-title">睡眠・精神</div>
                    <div class="symptom-item">
                        <input type="checkbox" id="insomnia" value="寝つきが悪い">
                        <label for="insomnia">寝つきが悪い</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="sleep_quality" value="眠りが浅い">
                        <label for="sleep_quality">眠りが浅い</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="irritability" value="イライラしやすい">
                        <label for="irritability">イライラしやすい</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="concentration" value="集中力が続かない">
                        <label for="concentration">集中力が続かない</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="mood" value="気分の落ち込み">
                        <label for="mood">気分の落ち込み</label>
                    </div>
                </div>

                <div class="symptom-category">
                    <div class="category-title">皮膚・髪・爪</div>
                    <div class="symptom-item">
                        <input type="checkbox" id="dry_skin" value="肌の乾燥">
                        <label for="dry_skin">肌の乾燥</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="skin_trouble" value="肌荒れしやすい">
                        <label for="skin_trouble">肌荒れしやすい</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="hair_loss" value="髪の毛が抜けやすい">
                        <label for="hair_loss">髪の毛が抜けやすい</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="nail_weak" value="爪が割れやすい">
                        <label for="nail_weak">爪が割れやすい</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="wound_healing" value="傷の治りが遅い">
                        <label for="wound_healing">傷の治りが遅い</label>
                    </div>
                </div>

                <div class="symptom-category">
                    <div class="category-title">目・口</div>
                    <div class="symptom-item">
                        <input type="checkbox" id="eye_fatigue" value="目の疲れ">
                        <label for="eye_fatigue">目の疲れ</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="dry_eyes" value="目の乾燥">
                        <label for="dry_eyes">目の乾燥</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="mouth_ulcer" value="口内炎ができやすい">
                        <label for="mouth_ulcer">口内炎ができやすい</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="dry_mouth" value="口の渇き">
                        <label for="dry_mouth">口の渇き</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="taste" value="味覚の変化">
                        <label for="taste">味覚の変化</label>
                    </div>
                </div>

                <div class="symptom-category">
                    <div class="category-title">その他</div>
                    <div class="symptom-item">
                        <input type="checkbox" id="muscle_cramp" value="筋肉がつりやすい">
                        <label for="muscle_cramp">筋肉がつりやすい</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="joint_pain" value="関節の痛み">
                        <label for="joint_pain">関節の痛み</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="headache" value="頭痛がよくある">
                        <label for="headache">頭痛がよくある</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="dizziness" value="めまいがする">
                        <label for="dizziness">めまいがする</label>
                    </div>
                    <div class="symptom-item">
                        <input type="checkbox" id="immunity" value="風邪をひきやすい">
                        <label for="immunity">風邪をひきやすい</label>
                    </div>
                </div>
            </div>

            <div class="button-container">
                <button class="analyze-button" onclick="analyzeSymptoms()">栄養素を分析する</button>
            </div>

            <div class="loading">
                <div class="loading-spinner"></div>
                <p>分析中です...</p>
            </div>

            <div class="result-container">
                <h2 class="result-title">分析結果</h2>
                <div class="result-content"></div>
            </div>
        </div>
    </div>

    <script>
        // 禁止ワードリスト
        const prohibitedWords = [
            // 薬事法関連
            '治る', '治す', '治療', '完治', '即効', '特効', '万能',
            '医薬品', '処方箋', '診断', '病名',
            // 効果効能の誇張
            '確実に', '必ず', '絶対', '100%', '劇的に',
            '痩せる', 'ダイエット効果', '脂肪燃焼',
            '精力増強', '性機能向上', 'ED改善',
            // 商品名・メーカー名（例）
            'サプリメント名', '製薬会社名',
            // その他
            '癌', 'がん', '腫瘍', '重病'
        ];

        // 禁止ワードチェック関数
        function checkProhibitedWords(text) {
            const foundWords = [];
            prohibitedWords.forEach(word => {
                if (text.includes(word)) {
                    foundWords.push(word);
                }
            });
            return foundWords;
        }

        // システムプロンプト
        const systemPrompt = `あなたは栄養学と東洋医学の知識を持つ健康アドバイザーです。
ユーザーの体調症状から、不足している可能性のある栄養素やビタミンを分析し、適切な食材を提案してください。

以下の点に注意してください：
1. 医療診断や治療に関する発言は避ける
2. 薬事法に抵触する表現を使わない
3. 商品名やメーカー名は出さない
4. 効果効能を誇張しない
5. あくまで一般的な栄養学的アドバイスに留める
6. 東洋医学の「気・血・水」の考え方も参考にする
7. 食材の提案は身近で入手しやすいものを中心にする

回答は以下の形式で：
【不足している可能性のある栄養素】
- 栄養素名：理由と説明

【おすすめの食材】
- 食材名：含まれる栄養素と期待される働き

【生活習慣のアドバイス】
- 具体的なアドバイス

※注意：これは一般的な栄養学的アドバイスです。症状が続く場合は医療機関を受診してください。`;

        async function analyzeSymptoms() {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                alert('APIキーを入力してください');
                return;
            }

            // チェックされた症状を取得
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            if (checkboxes.length === 0) {
                alert('少なくとも1つの症状を選択してください');
                return;
            }

            const symptoms = Array.from(checkboxes).map(cb => cb.value);
            const symptomText = symptoms.join('、');

            // UI更新
            document.querySelector('.analyze-button').disabled = true;
            document.querySelector('.loading').style.display = 'block';
            document.querySelector('.result-container').style.display = 'none';

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: `以下の症状があります：${symptomText}\n\nこれらの症状から考えられる栄養素の不足と、おすすめの食材を教えてください。` }
                        ],
                        temperature: 0.7,
                        max_tokens: 1000
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                const result = data.choices[0].message.content;

                // 禁止ワードチェック
                const foundProhibitedWords = checkProhibitedWords(result);
                if (foundProhibitedWords.length > 0) {
                    console.warn('禁止ワードが検出されました:', foundProhibitedWords);
                    // 実際の実装では、結果をフィルタリングするか再生成する
                }

                // 結果表示
                document.querySelector('.result-content').textContent = result;
                document.querySelector('.result-container').style.display = 'block';

            } catch (error) {
                console.error('Error:', error);
                alert('分析中にエラーが発生しました。APIキーを確認してください。');
            } finally {
                document.querySelector('.analyze-button').disabled = false;
                document.querySelector('.loading').style.display = 'none';
            }
        }

        // エンターキーでの誤送信を防ぐ
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.target.tagName !== 'BUTTON') {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>