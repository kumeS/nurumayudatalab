# DIYアシスタント - AI 3D家具設計ツール

## 概要

DIYアシスタントは、自然言語の入力からAIが3D家具モデルを生成し、ブラウザ上でプレビューできるWebアプリケーションです。多段階AI処理パイプラインにより、高品質な3Dモデルを生成し、OBJやSTL形式でダウンロードできます。

## 主な機能

### 🎯 多段階AI処理パイプライン
- **第1段階**: 仕様分析・最適化（LLM）
- **第2段階**: 3Dモデル生成（DeepSeek-R1推論モデル）
- **第3段階**: 品質検証・チェック（将来実装予定）

### 🔮 リアルタイム3Dプレビュー
- Three.jsを活用したインタラクティブ3Dビューア
- マウス操作による回転・ズーム・パン
- 高度な中心点操作機能
- 家具タイプ別の最適化されたマテリアル

### 📊 処理状況の可視化
- 3段階処理の進行状況表示
- 各段階の生出力データ確認機能（iマーク）
- デバッグモードによる詳細ログ

### 💼 プロジェクト管理
- 作成済みプロジェクトの一覧表示・管理
- セッション復元機能
- ローカルストレージによる状態保持

### 🚀 クイックスタート機能
- 10種類のサンプルプロンプト
- ワンクリックでの家具生成開始

## ファイル構成

```
webtool-DIY-assist/
├── index.html              # メインHTML（UI定義・CSS・Three.js読み込み）
├── core.js                 # コア機能・UI管理・プロジェクト管理
├── processing.js           # AI処理パイプライン・多段階処理管理
├── ai.js                   # AI統合・LLM API通信
├── scene.js                # 3Dシーン管理・Three.js操作
├── app.js                  # アプリケーション初期化・ブラウザ互換性チェック
├── obj/                    # 生成されたOBJファイル保存ディレクトリ
├── CLAUDE.md              # Claude開発ガイド
└── README.md              # このファイル
```

## 技術仕様

### フロントエンド
- **HTML5/CSS3**: レスポンシブUI設計、CSS Grid/Flexbox
- **JavaScript (ES6+)**: モジュール化されたクラスベース実装
- **Three.js (v0.158.0)**: 3Dレンダリングエンジン、ES Modules対応

### AIバックエンド
- **第1段階LLM**: `meta-llama/Llama-4-Maverick-17B-128E-Instruct-FP8`
- **第2段階LLM**: DeepSeek-R1推論モデル（高精度3D生成）
- **API エンドポイント**: `https://nurumayu-worker.skume-bioinfo.workers.dev/`
- **出力形式**: Wavefront OBJ

### アーキテクチャ
```
ユーザー入力 → 第1段階（仕様分析） → 第2段階（3D生成） → 3Dプレビュー → ダウンロード
     ↓              ↓                    ↓
  サンプル選択   自然言語仕様        OBJデータ生成
     ↓         最適化・構造化           ↓
  パラメータ      制約条件抽出      品質検証・修正
```

## 主要クラス構成

### DIYAssistant (core.js)
- アプリケーションのメインクラス
- UI管理、イベントハンドリング
- プロジェクト管理、セッション復元
- デバッグ・ログ機能

### ProcessingManager (processing.js)
- 多段階AI処理パイプラインの統括
- 第1段階：仕様分析・最適化
- 第2段階：3Dモデル生成
- エラーハンドリング・フォールバック機能

### AIManager (ai.js)
- LLM API通信
- プロンプト最適化
- OBJ/STLデータ処理
- インテリジェントリトライ機能

### SceneManager (scene.js)
- Three.js 3Dシーン管理
- 家具タイプ別マテリアル適用
- 高度なカメラ操作・中心点制御
- パフォーマンス最適化

## 使用方法

### 基本操作
1. **要件入力**: テキストエリアに家具の仕様を記述
2. **パラメータ設定**: 幅・奥行・高さを数値で指定（任意）
3. **生成実行**: 「3Dモデル生成」ボタンをクリック
4. **進行状況確認**: 3段階の処理状況を監視
5. **プレビュー**: 3Dモデルをマウス操作で確認
6. **ダウンロード**: OBJ/STLファイルを取得

### クイックスタート
10種類のサンプルから選択：
- シンプルな木製椅子
- シンプルな木製机
- シンプルな本棚
- シンプルなスツール
- シンプルな収納ボックス
- シンプルなコーヒーテーブル
- シンプルなナイトスタンド
- シンプルなプラントスタンド
- シンプルなシューズラック
- シンプルなマガジンラック

### 入力例
```
シンプルな木製の椅子を作ってください
```

### 3D操作
- **回転**: マウス左ドラッグ
- **ズーム**: マウスホイール
- **パン**: マウス右ドラッグ
- **中心変更**: ダブルクリック
- **中心リセット**: Ctrl+R
- **中心表示切り替え**: Ctrl+C

### 生出力データ確認
各処理段階の右上に表示される「i」マークをクリックすると、その段階の生出力データを確認できます。

## 開発者向け情報

### セットアップ
1. リポジトリをクローン
2. `index.html`をブラウザで開く
3. HTTPサーバー推奨（CORS対応）

### デバッグモード
- URLパラメータ: `?debug=true`
- ローカルストレージ: `diy_debug_mode=true`
- デバッグパネルでリアルタイム監視

### API仕様
```javascript
// 第1段階 LLM API呼び出し例
{
  model: "meta-llama/Llama-4-Maverick-17B-128E-Instruct-FP8",
  temperature: 0.3,
  max_completion_tokens: 1500,
  messages: [
    {
      role: "system",
      content: "家具設計仕様書作成の専門家として..."
    },
    {
      role: "user",
      content: "シンプルな木製の椅子を作ってください"
    }
  ]
}

// 第2段階 DeepSeek API呼び出し例
{
  model: "deepseek-reasoner",
  temperature: 0.1,
  max_completion_tokens: 4000,
  messages: [...]
}
```

### ローカルストレージ構造
```javascript
// プロジェクト管理
diy_projects: [
  {
    id: "timestamp",
    prompt: "ユーザー入力",
    objData: "OBJデータ",
    furnitureType: "家具タイプ",
    timestamp: "ISO日時",
    optimizedSpec: {...},
    stage1Data: {...},
    stage2Data: {...}
  }
]

// セッション管理
diy_current_session: {
  currentProject: {...},
  hasActiveModel: true,
  timestamp: 1234567890
}

// 生出力データ
diy_stage_raw_data: {
  stage1: "第1段階の生出力",
  stage2: "第2段階の生出力",
  stage3: "第3段階の生出力"
}
```

## パフォーマンス最適化

### 3Dレンダリング
- アンチエイリアシング有効
- シャドウマッピング（PCFSoft）
- トーンマッピング（ACES Filmic）
- デバイスピクセル比制限（最大2.0）

### メモリ管理
- OBJデータの適切なクリーンアップ
- Three.jsオブジェクトの明示的な破棄
- ログ履歴の自動制限（最大1000件）

### API最適化
- インテリジェントリトライ機能
- タイムアウト制御
- エラー回復プロンプト生成

## トラブルシューティング

### よくある問題
1. **Three.js読み込みエラー**: ページ再読み込み
2. **API接続エラー**: ネットワーク接続確認
3. **3D表示問題**: WebGL対応ブラウザ使用
4. **メモリ不足**: ブラウザ再起動

### デバッグ機能
- エラーログの自動保存
- セッション復元エラーレポート
- パフォーマンス監視
- ログエクスポート機能

## 今後の拡張予定

### 近未来の機能
- 第3段階品質検証の完全実装
- ARプレビュー機能
- マルチマテリアル対応
- コラボレーション機能
- CADソフト連携

### カスタマイズポイント
- LLMプロンプトの最適化
- 3Dレンダリング設定
- 家具タイプ別カラーパレット
- ファイル変換アルゴリズム

## ライセンス

このプロジェクトは、ぬるま湯データラボの一部として開発されています。

## サポート

問題や提案がある場合は、プロジェクトのIssueとして報告してください。

---

**最終更新**: 2025年1月
**バージョン**: 2.0.0
**対応ブラウザ**: Chrome, Firefox, Edge, Safari (最新版)