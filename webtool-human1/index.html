<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººç”Ÿåˆ†å²ä½“é¨“ - Your Life Path</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ */
        .welcome-screen {
            text-align: center;
            padding: 60px 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-top: 40px;
        }

        .welcome-screen h1 {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .welcome-screen p {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 30px;
        }

        .form-group {
            margin: 20px auto;
            max-width: 400px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: #555;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            display: inline-block;
            padding: 15px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        /* ã‚²ãƒ¼ãƒ ç”»é¢ */
        .game-screen {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            margin-top: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .stage-info {
            text-align: center;
            margin-bottom: 30px;
        }

        .stage-info h2 {
            font-size: 2em;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stage-progress {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
        }

        .progress-dot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e1e1e1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: all 0.3s;
        }

        .progress-dot.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: scale(1.2);
        }

        .progress-dot.completed {
            background: #4CAF50;
        }

        .scene-image {
            width: 100%;
            max-width: 600px;
            height: 400px;
            margin: 20px auto;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f0f0;
            position: relative;
        }

        .scene-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .placeholder-image {
            font-size: 1.2em;
            color: #999;
            text-align: center;
            padding: 20px;
        }

        .hint-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }

        .hint-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .choices-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .choice-card {
            background: white;
            border: 2px solid #e1e1e1;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .choice-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.2);
        }

        .choice-card h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .choice-card p {
            color: #666;
            font-size: 0.9em;
        }

        /* çµæœç”»é¢ */
        .result-screen {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            margin-top: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .result-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .result-header h2 {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 20px;
        }

        .life-type {
            font-size: 1.5em;
            color: #764ba2;
            margin-bottom: 20px;
        }

        .analysis-box {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .rewards-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 30px 0;
            justify-content: center;
        }

        .reward-badge {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .cheat-tips {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
        }

        .cheat-tips h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .cheat-tips ul {
            list-style: none;
        }

        .cheat-tips li {
            color: white;
            margin: 10px 0;
            padding-left: 20px;
            position: relative;
        }

        .cheat-tips li:before {
            content: "âœ¨";
            position: absolute;
            left: 0;
        }

        .life-journey {
            margin: 40px 0;
        }

        .journey-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .journey-image {
            width: 150px;
            height: 150px;
            border-radius: 10px;
            overflow: hidden;
            flex-shrink: 0;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .journey-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .journey-content {
            flex: 1;
        }

        .journey-content h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .action-buttons {
            text-align: center;
            margin-top: 40px;
        }

        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .welcome-screen h1 {
                font-size: 2em;
            }

            .journey-item {
                flex-direction: column;
            }

            .journey-image {
                width: 100%;
                height: 200px;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
        <div class="welcome-screen" id="welcomeScreen">
            <h1>ğŸŒŸ äººç”Ÿåˆ†å²ä½“é¨“ ğŸŒŸ</h1>
            <p>ã‚ãªãŸã®é¸æŠã§å¤‰ã‚ã‚‹ã€ã‚‚ã†ä¸€ã¤ã®äººç”Ÿã‚’ä½“é¨“ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ</p>
            
            <div class="form-group">
                <label for="userName">ã‚ãªãŸã®ãŠåå‰</label>
                <input type="text" id="userName" placeholder="åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" required>
            </div>
            
            <div class="form-group">
                <label for="lifeMood">ã©ã‚“ãªäººç”Ÿã‚’ä½“é¨“ã—ãŸã„ã§ã™ã‹ï¼Ÿ</label>
                <select id="lifeMood">
                    <option value="åˆºæ¿€çš„ãªäººç”Ÿ">åˆºæ¿€çš„ãªäººç”Ÿ</option>
                    <option value="å®‰å®šã—ãŸäººç”Ÿ">å®‰å®šã—ãŸäººç”Ÿ</option>
                    <option value="å‰µé€ çš„ãªäººç”Ÿ">å‰µé€ çš„ãªäººç”Ÿ</option>
                    <option value="ç¤¾ä¼šè²¢çŒ®ã®äººç”Ÿ">ç¤¾ä¼šè²¢çŒ®ã®äººç”Ÿ</option>
                </select>
            </div>
            
            <button class="btn" onclick="startGame()">äººç”Ÿã‚’å§‹ã‚ã‚‹</button>
        </div>

        <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
        <div class="game-screen" id="gameScreen">
            <div class="stage-progress">
                <div class="progress-dot" data-stage="0">å¹¼å°‘</div>
                <div class="progress-dot" data-stage="1">é’å¹´</div>
                <div class="progress-dot" data-stage="2">20ä»£</div>
                <div class="progress-dot" data-stage="3">30-40</div>
                <div class="progress-dot" data-stage="4">50-60</div>
            </div>

            <div class="stage-info">
                <h2 id="stageTitle">å¹¼å°‘æœŸ</h2>
                <p id="stageDescription">ã‚ãªãŸã®äººç”Ÿã®å§‹ã¾ã‚Šã€‚ã©ã‚“ãªå­ä¾›æ™‚ä»£ã‚’éã”ã—ã¾ã™ã‹ï¼Ÿ</p>
            </div>

            <div class="scene-image" id="sceneImage">
                <div class="placeholder-image">
                    ç”»åƒç”Ÿæˆä¸­...
                </div>
            </div>

            <div class="hint-box" id="hintBox">
                <h3>ğŸ’¡ äººç”Ÿã®ãƒ’ãƒ³ãƒˆ</h3>
                <p id="hintText">é¸æŠã®å‰ã«ã€å°‘ã—ç«‹ã¡æ­¢ã¾ã£ã¦è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
            </div>

            <div class="choices-container" id="choicesContainer">
                <!-- é¸æŠè‚¢ã¯JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
            </div>
        </div>

        <!-- çµæœç”»é¢ -->
        <div class="result-screen" id="resultScreen">
            <div class="result-header">
                <h2>ğŸŠ ã‚ãªãŸã®äººç”Ÿç‰©èª ğŸŠ</h2>
                <div class="life-type" id="lifeType">åŠªåŠ›å‹ã‚µã‚¯ã‚»ã‚¹äººç”Ÿ</div>
            </div>

            <div class="analysis-box">
                <h3>ğŸ“Š äººç”Ÿåˆ†æ</h3>
                <p id="analysisText">ã‚ãªãŸã¯æŒ‘æˆ¦ã¨åŠªåŠ›ã§å›°é›£ã‚’ä¹—ã‚Šè¶Šãˆã‚‹ã‚¿ã‚¤ãƒ—ã§ã™ã€‚</p>
            </div>

            <div class="rewards-container" id="rewardsContainer">
                <!-- ãƒªãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚¸ã¯JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
            </div>

            <div class="cheat-tips">
                <h3>ğŸ¯ ç¾å®Ÿã§ä½¿ãˆã‚‹äººç”Ÿãƒãƒ¼ãƒˆ</h3>
                <ul id="cheatTipsList">
                    <!-- ãƒãƒ¼ãƒˆãƒ†ã‚£ãƒƒãƒ—ã‚¹ã¯JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </ul>
            </div>

            <div class="life-journey">
                <h3>ğŸ“– ã‚ãªãŸã®äººç”Ÿã®è»Œè·¡</h3>
                <div id="journeyContainer">
                    <!-- äººç”Ÿã®è»Œè·¡ã¯JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn" onclick="downloadPDF()">ğŸ“„ PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                <button class="btn" onclick="shareResult()">ğŸ”— ã‚·ã‚§ã‚¢ã™ã‚‹</button>
                <button class="btn" onclick="restartGame()">ğŸ”„ ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
            </div>
        </div>

        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>å‡¦ç†ä¸­...</p>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿
        const gameData = {
            stages: [
                {
                    name: "childhood",
                    title: "å¹¼å°‘æœŸ",
                    description: "ã‚ãªãŸã®äººç”Ÿã®å§‹ã¾ã‚Šã€‚ã©ã‚“ãªå­ä¾›æ™‚ä»£ã‚’éã”ã—ã¾ã™ã‹ï¼Ÿ",
                    choices: [
                        {
                            id: "bookworm",
                            title: "æœ¬å¥½ããªå­ä¾›",
                            description: "å›³æ›¸é¤¨ãŒéŠã³å ´ã€‚ç‰©èªã®ä¸–ç•Œã«å¤¢ä¸­ã«ãªã‚‹æ—¥ã€…ã€‚"
                        },
                        {
                            id: "athlete",
                            title: "é‹å‹•å¤§å¥½ãã£å­",
                            description: "å¤–ã§éŠã¶ã®ãŒå¤§å¥½ãã€‚å‹é”ã¨ã‚µãƒƒã‚«ãƒ¼ã‚„é‡çƒã«å¤¢ä¸­ã€‚"
                        },
                        {
                            id: "artist",
                            title: "èŠ¸è¡“å®¶ã®åµ",
                            description: "çµµã‚’æã„ãŸã‚Šã€éŸ³æ¥½ã‚’è´ã„ãŸã‚Šã€‚å‰µé€ çš„ãªéŠã³ãŒå¥½ãã€‚"
                        },
                        {
                            id: "inventor",
                            title: "ç™ºæ˜å®¶æ°—è³ª",
                            description: "ãŠã‚‚ã¡ã‚ƒã‚’åˆ†è§£ã—ãŸã‚Šã€æ–°ã—ã„ã‚‚ã®ã‚’ä½œã‚‹ã®ãŒå¥½ãã€‚"
                        }
                    ]
                },
                {
                    name: "teen",
                    title: "é’å¹´æœŸ",
                    description: "æ€æ˜¥æœŸã®é¸æŠã€‚ã©ã‚“ãªé“ã‚’é¸ã³ã¾ã™ã‹ï¼Ÿ",
                    choices: [
                        {
                            id: "studious",
                            title: "å‹‰å¼·ã«æ‰“ã¡è¾¼ã‚€",
                            description: "å°†æ¥ã®å¤¢ã«å‘ã‹ã£ã¦ã€å—é¨“å‹‰å¼·ã«å…¨åŠ›æŠ•çƒã€‚"
                        },
                        {
                            id: "club",
                            title: "éƒ¨æ´»ã§é’æ˜¥",
                            description: "ä»²é–“ã¨å…±ã«æ±—ã‚’æµã—ã€å¤§ä¼šã‚’ç›®æŒ‡ã™æ—¥ã€…ã€‚"
                        },
                        {
                            id: "parttime",
                            title: "ã‚¢ãƒ«ãƒã‚¤ãƒˆçµŒé¨“",
                            description: "ç¤¾ä¼šçµŒé¨“ã‚’ç©ã¿ãªãŒã‚‰ã€è‡ªç«‹ã¸ã®ç¬¬ä¸€æ­©ã€‚"
                        },
                        {
                            id: "creative",
                            title: "å‰µä½œæ´»å‹•",
                            description: "ãƒãƒ³ãƒ‰æ´»å‹•ã‚„å‰µä½œã«æ²¡é ­ã™ã‚‹ã€è¡¨ç¾è€…ã®é“ã€‚"
                        }
                    ]
                },
                {
                    name: "twenties",
                    title: "20ä»£",
                    description: "äººç”Ÿã®å²è·¯ã€‚ã©ã‚“ãªæŒ‘æˆ¦ã‚’é¸ã³ã¾ã™ã‹ï¼Ÿ",
                    choices: [
                        {
                            id: "career",
                            title: "ã‚­ãƒ£ãƒªã‚¢ã‚’ç©ã‚€",
                            description: "å¤§ä¼æ¥­ã§ç€å®Ÿã«ã‚­ãƒ£ãƒªã‚¢ã‚’ç¯‰ãé“ã€‚"
                        },
                        {
                            id: "startup",
                            title: "èµ·æ¥­ã«æŒ‘æˆ¦",
                            description: "ãƒªã‚¹ã‚¯ã‚’å–ã£ã¦ã€è‡ªåˆ†ã®ãƒ“ã‚¸ãƒã‚¹ã‚’ç«‹ã¡ä¸Šã’ã‚‹ã€‚"
                        },
                        {
                            id: "abroad",
                            title: "æµ·å¤–ç•™å­¦",
                            description: "ç•°æ–‡åŒ–ã®ä¸­ã§è‡ªåˆ†ã‚’è¦‹ã¤ã‚ç›´ã™å†’é™ºã€‚"
                        },
                        {
                            id: "freelance",
                            title: "ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹",
                            description: "è‡ªç”±ãªåƒãæ–¹ã‚’æ±‚ã‚ã¦ã€ç‹¬ç«‹ã®é“ã¸ã€‚"
                        }
                    ]
                },
                {
                    name: "thirties",
                    title: "30-40ä»£",
                    description: "äººç”Ÿã®å……å®ŸæœŸã€‚ä½•ã‚’å¤§åˆ‡ã«ã—ã¾ã™ã‹ï¼Ÿ",
                    choices: [
                        {
                            id: "family",
                            title: "å®¶æ—ã¨ã®æ™‚é–“",
                            description: "å®¶æ—ã‚’æœ€å„ªå…ˆã«ã€æ¸©ã‹ã„å®¶åº­ã‚’ç¯‰ãã€‚"
                        },
                        {
                            id: "executive",
                            title: "çµŒå–¶è€…ã¨ã—ã¦",
                            description: "çµ„ç¹”ã®ãƒˆãƒƒãƒ—ã¨ã—ã¦ã€ç¤¾ä¼šã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ã€‚"
                        },
                        {
                            id: "expert",
                            title: "å°‚é–€å®¶ã®é“",
                            description: "ä¸€ã¤ã®åˆ†é‡ã‚’æ¥µã‚ã€ç¬¬ä¸€äººè€…ã‚’ç›®æŒ‡ã™ã€‚"
                        },
                        {
                            id: "balance",
                            title: "ãƒ¯ãƒ¼ã‚¯ãƒ©ã‚¤ãƒ•ãƒãƒ©ãƒ³ã‚¹",
                            description: "ä»•äº‹ã‚‚è¶£å‘³ã‚‚å¤§åˆ‡ã«ã€å……å®Ÿã—ãŸæ—¥ã€…ã‚’é€ã‚‹ã€‚"
                        }
                    ]
                },
                {
                    name: "fifties",
                    title: "50-60ä»£",
                    description: "äººç”Ÿã®é›†å¤§æˆã€‚ã©ã‚“ãªç”Ÿãæ–¹ã‚’é¸ã³ã¾ã™ã‹ï¼Ÿ",
                    choices: [
                        {
                            id: "mentor",
                            title: "æ¬¡ä¸–ä»£è‚²æˆ",
                            description: "çµŒé¨“ã‚’æ´»ã‹ã—ã¦ã€è‹¥ã„ä¸–ä»£ã‚’å°ãã€‚"
                        },
                        {
                            id: "adventure",
                            title: "æ–°ãŸãªæŒ‘æˆ¦",
                            description: "å¹´é½¢ã«é–¢ä¿‚ãªãã€æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã—ç¶šã‘ã‚‹ã€‚"
                        },
                        {
                            id: "retirement",
                            title: "æ‚ ã€…è‡ªé©",
                            description: "è¶£å‘³ã‚„æ—…è¡Œã‚’æ¥½ã—ã‚€ã€ç¬¬äºŒã®äººç”Ÿã€‚"
                        },
                        {
                            id: "contribution",
                            title: "ç¤¾ä¼šè²¢çŒ®",
                            description: "ãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢ã‚„åœ°åŸŸæ´»å‹•ã§ç¤¾ä¼šã«æ©è¿”ã—ã€‚"
                        }
                    ]
                }
            ]
        };

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let gameState = {
            user: {
                name: "",
                lifeMood: ""
            },
            currentStage: 0,
            lifePath: [],
            summary: null
        };

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            const userName = document.getElementById('userName').value.trim();
            const lifeMood = document.getElementById('lifeMood').value;

            if (!userName) {
                alert('åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            gameState.user.name = userName;
            gameState.user.lifeMood = lifeMood;
            gameState.currentStage = 0;
            gameState.lifePath = [];

            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';

            updateStage();
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¸æ›´æ–°
        function updateStage() {
            const stage = gameData.stages[gameState.currentStage];
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°
            document.querySelectorAll('.progress-dot').forEach((dot, index) => {
                if (index < gameState.currentStage) {
                    dot.classList.add('completed');
                    dot.classList.remove('active');
                } else if (index === gameState.currentStage) {
                    dot.classList.add('active');
                    dot.classList.remove('completed');
                } else {
                    dot.classList.remove('active', 'completed');
                }
            });

            // ã‚¹ãƒ†ãƒ¼ã‚¸æƒ…å ±æ›´æ–°
            document.getElementById('stageTitle').textContent = stage.title;
            document.getElementById('stageDescription').textContent = stage.description;

            // ãƒ’ãƒ³ãƒˆç”Ÿæˆï¼ˆå®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯LLMã‚’ä½¿ç”¨ï¼‰
            const hint = generateHint(stage, gameState);
            document.getElementById('hintText').textContent = hint;

            // ç”»åƒã‚’ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã«æˆ»ã™
            document.getElementById('sceneImage').innerHTML = '<div class="placeholder-image">é¸æŠå¾Œã€ç”»åƒãŒç”Ÿæˆã•ã‚Œã¾ã™</div>';

            // é¸æŠè‚¢ã‚’è¡¨ç¤º
            displayChoices(stage.choices);
        }

        // ãƒ’ãƒ³ãƒˆç”Ÿæˆï¼ˆç°¡æ˜“ç‰ˆï¼‰
        function generateHint(stage, gameState) {
            const hints = {
                childhood: [
                    "å¹¼å°‘æœŸã®ä½“é¨“ã¯ã€ã‚ãªãŸã®ä¾¡å€¤è¦³ã®åŸºç¤ã‚’ä½œã‚Šã¾ã™ã€‚",
                    "å¥½å¥‡å¿ƒã¯äººç”Ÿæœ€å¤§ã®åŸå‹•åŠ›ã€‚ä½•ã«èˆˆå‘³ã‚’æŒã¤ã‹ã§æœªæ¥ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚",
                    "å­ä¾›ã®é ƒã®ã€Œå¥½ãã€ã¯ã€å¤§äººã«ãªã£ã¦ã‚‚å¿ƒã®æ”¯ãˆã«ãªã‚Šã¾ã™ã€‚"
                ],
                teen: [
                    "é’æ˜¥æ™‚ä»£ã®é¸æŠã¯ã€ã‚ãªãŸã®å¯èƒ½æ€§ã‚’åºƒã’ã¾ã™ã€‚",
                    "å¤±æ•—ã‚’æã‚Œãšã«æŒ‘æˆ¦ã™ã‚‹ã“ã¨ã§ã€æœ¬å½“ã®è‡ªåˆ†ãŒè¦‹ãˆã¦ãã¾ã™ã€‚",
                    "ä»²é–“ã¨ã®çµ†ã¯ã€äººç”Ÿã®å®ç‰©ã«ãªã‚Šã¾ã™ã€‚"
                ],
                twenties: [
                    "20ä»£ã¯äººç”Ÿã®åœŸå°ä½œã‚Šã€‚ã©ã‚“ãªç¨®ã‚’è’”ãã‹ãŒé‡è¦ã§ã™ã€‚",
                    "ãƒªã‚¹ã‚¯ã‚’å–ã‚‹ã“ã¨ã‚‚ã€å®‰å®šã‚’é¸ã¶ã“ã¨ã‚‚ã€ã©ã¡ã‚‰ã‚‚æ­£è§£ã§ã™ã€‚",
                    "è‡ªåˆ†ã®å¿ƒã®å£°ã«è€³ã‚’å‚¾ã‘ã¦ã¿ã¾ã—ã‚‡ã†ã€‚"
                ],
                thirties: [
                    "30-40ä»£ã¯äººç”Ÿã®å®Ÿã‚Šã®æ™‚æœŸã€‚ä½•ã‚’åç©«ã—ãŸã„ã§ã™ã‹ï¼Ÿ",
                    "ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹ã“ã¨ã‚‚ã€ä¸€ç‚¹çªç ´ã™ã‚‹ã“ã¨ã‚‚ã€ã‚ãªãŸæ¬¡ç¬¬ã§ã™ã€‚",
                    "ã“ã‚Œã¾ã§ã®çµŒé¨“ãŒã€æ–°ã—ã„å¯èƒ½æ€§ã‚’é–‹ãã¾ã™ã€‚"
                ],
                fifties: [
                    "50-60ä»£ã¯äººç”Ÿã®é›†å¤§æˆã€‚ã©ã‚“ãª legacy ã‚’æ®‹ã—ã¾ã™ã‹ï¼Ÿ",
                    "å¹´é½¢ã¯å˜ãªã‚‹æ•°å­—ã€‚æƒ…ç†±ãŒã‚ã‚Œã°ä½•ã§ã‚‚ã§ãã¾ã™ã€‚",
                    "ã“ã‚Œã¾ã§ã®çµŒé¨“ã‚’ã€æ¬¡ã®ä¸–ä»£ã«ç¹‹ã’ã‚‹ã“ã¨ã‚‚ç´ æ™´ã‚‰ã—ã„é¸æŠã§ã™ã€‚"
                ]
            };

            const stageHints = hints[stage.name];
            return stageHints[Math.floor(Math.random() * stageHints.length)];
        }

        // é¸æŠè‚¢è¡¨ç¤º
        function displayChoices(choices) {
            const container = document.getElementById('choicesContainer');
            container.innerHTML = '';

            choices.forEach(choice => {
                const card = document.createElement('div');
                card.className = 'choice-card';
                card.onclick = () => selectChoice(choice);
                
                card.innerHTML = `
                    <h4>${choice.title}</h4>
                    <p>${choice.description}</p>
                `;
                
                container.appendChild(card);
            });
        }

        // é¸æŠå‡¦ç†
        function selectChoice(choice) {
            showLoading();
            
            const stage = gameData.stages[gameState.currentStage];
            
            // ç”»åƒç”Ÿæˆï¼ˆå®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯AIç”»åƒç”ŸæˆAPIã‚’ä½¿ç”¨ï¼‰
            const imagePrompt = generateImagePrompt(stage, choice, gameState);
            const fakeImage = generatePlaceholderImage(stage.name, choice.id);
            
            // AIã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆï¼ˆå®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯LLMã‚’ä½¿ç”¨ï¼‰
            const comment = generateComment(stage, choice, gameState);
            
            // é¸æŠã‚’è¨˜éŒ²
            gameState.lifePath.push({
                scene: stage.name,
                choice: choice.title,
                hint: document.getElementById('hintText').textContent,
                image: fakeImage,
                comment: comment
            });

            // ç”»åƒè¡¨ç¤º
            setTimeout(() => {
                document.getElementById('sceneImage').innerHTML = `<img src="${fakeImage}" alt="${choice.title}">`;
                hideLoading();

                // æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸
                setTimeout(() => {
                    gameState.currentStage++;
                    if (gameState.currentStage < gameData.stages.length) {
                        updateStage();
                    } else {
                        showResult();
                    }
                }, 2000);
            }, 1000);
        }

        // ç”»åƒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
        function generateImagePrompt(stage, choice, gameState) {
            return `${stage.title}ã®${gameState.user.name}ãŒ${choice.title}ã‚’é¸æŠã€${gameState.user.lifeMood}ã®é›°å›²æ°—ã€å¸Œæœ›ã«æº€ã¡ãŸè¡¨æƒ…`;
        }

        // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ç”»åƒç”Ÿæˆ
        function generatePlaceholderImage(stageName, choiceId) {
            // å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯AIç”»åƒç”ŸæˆAPIã®çµæœã‚’ä½¿ç”¨
            const colors = {
                childhood: '#FFE5B4',
                teen: '#B4E5FF',
                twenties: '#FFB4E5',
                thirties: '#B4FFB4',
                fifties: '#E5B4FF'
            };
            
            const canvas = document.createElement('canvas');
            canvas.width = 600;
            canvas.height = 400;
            const ctx = canvas.getContext('2d');
            
            // ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, 600, 400);
            gradient.addColorStop(0, colors[stageName] || '#FFE5B4');
            gradient.addColorStop(1, '#FFFFFF');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 600, 400);
            
            // ãƒ†ã‚­ã‚¹ãƒˆ
            ctx.fillStyle = '#666';
            ctx.font = '24px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(`${stageName} - ${choiceId}`, 300, 200);
            
            return canvas.toDataURL();
        }

        // ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
        function generateComment(stage, choice, gameState) {
            const comments = {
                bookworm: "æœ¬ã‹ã‚‰å¾—ãŸçŸ¥è­˜ãŒã€ã‚ãªãŸã®ä¸–ç•Œã‚’åºƒã’ã¾ã—ãŸã€‚",
                athlete: "ã‚¹ãƒãƒ¼ãƒ„ã§åŸ¹ã£ãŸç²¾ç¥åŠ›ãŒã€äººç”Ÿã®æ”¯ãˆã«ãªã‚Šã¾ã—ãŸã€‚",
                artist: "å‰µé€ æ€§ãŒã‚ãªãŸã®äººç”Ÿã‚’å½©ã‚Šè±Šã‹ã«ã—ã¾ã—ãŸã€‚",
                inventor: "å¥½å¥‡å¿ƒã¨å‰µæ„å·¥å¤«ãŒã€æ–°ã—ã„é“ã‚’åˆ‡ã‚Šé–‹ãã¾ã—ãŸã€‚"
            };
            
            return comments[choice.id] || "ç´ æ™´ã‚‰ã—ã„é¸æŠã§ã—ãŸã€‚";
        }

        // çµæœè¡¨ç¤º
        function showResult() {
            // äººç”Ÿã‚¿ã‚¤ãƒ—åˆ¤å®šï¼ˆç°¡æ˜“ç‰ˆï¼‰
            const lifeType = determineLifeType(gameState.lifePath);
            const analysis = generateAnalysis(lifeType, gameState);
            const rewards = generateRewards(gameState.lifePath);
            const cheatTips = generateCheatTips(lifeType, gameState);

            gameState.summary = {
                type: lifeType,
                analysis: analysis,
                rewards: rewards,
                cheatTips: cheatTips
            };

            // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'block';

            // çµæœè¡¨ç¤º
            document.getElementById('lifeType').textContent = lifeType;
            document.getElementById('analysisText').textContent = analysis;

            // ãƒªãƒ¯ãƒ¼ãƒ‰è¡¨ç¤º
            const rewardsContainer = document.getElementById('rewardsContainer');
            rewardsContainer.innerHTML = '';
            rewards.forEach(reward => {
                const badge = document.createElement('div');
                badge.className = 'reward-badge';
                badge.textContent = reward.title;
                badge.title = reward.description;
                rewardsContainer.appendChild(badge);
            });

            // ãƒãƒ¼ãƒˆãƒ†ã‚£ãƒƒãƒ—ã‚¹è¡¨ç¤º
            const tipsList = document.getElementById('cheatTipsList');
            tipsList.innerHTML = '';
            cheatTips.forEach(tip => {
                const li = document.createElement('li');
                li.textContent = tip;
                tipsList.appendChild(li);
            });

            // äººç”Ÿã®è»Œè·¡è¡¨ç¤º
            const journeyContainer = document.getElementById('journeyContainer');
            journeyContainer.innerHTML = '';
            gameState.lifePath.forEach((path, index) => {
                const stageData = gameData.stages[index];
                const item = document.createElement('div');
                item.className = 'journey-item';
                item.innerHTML = `
                    <div class="journey-image">
                        <img src="${path.image}" alt="${path.choice}">
                    </div>
                    <div class="journey-content">
                        <h4>${stageData.title}: ${path.choice}</h4>
                        <p><strong>ãƒ’ãƒ³ãƒˆ:</strong> ${path.hint}</p>
                        <p><strong>çµæœ:</strong> ${path.comment}</p>
                    </div>
                `;
                journeyContainer.appendChild(item);
            });
        }

        // äººç”Ÿã‚¿ã‚¤ãƒ—åˆ¤å®š
        function determineLifeType(lifePath) {
            // ç°¡æ˜“çš„ãªåˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
            const types = [
                "æŒ‘æˆ¦å‹ã‚¤ãƒãƒ™ãƒ¼ã‚¿ãƒ¼äººç”Ÿ",
                "å …å®Ÿå‹ã‚µã‚¯ã‚»ã‚¹äººç”Ÿ",
                "å‰µé€ å‹ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆäººç”Ÿ",
                "ãƒãƒ©ãƒ³ã‚¹å‹å……å®Ÿäººç”Ÿ",
                "è²¢çŒ®å‹ãƒªãƒ¼ãƒ€ãƒ¼äººç”Ÿ"
            ];
            
            return types[Math.floor(Math.random() * types.length)];
        }

        // åˆ†æç”Ÿæˆ
        function generateAnalysis(lifeType, gameState) {
            const analyses = {
                "æŒ‘æˆ¦å‹ã‚¤ãƒãƒ™ãƒ¼ã‚¿ãƒ¼äººç”Ÿ": "ã‚ãªãŸã¯å¸¸ã«æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã—ã€å¤‰åŒ–ã‚’æã‚Œãªã„é©æ–°è€…ã§ã™ã€‚",
                "å …å®Ÿå‹ã‚µã‚¯ã‚»ã‚¹äººç”Ÿ": "ç€å®Ÿã«ç›®æ¨™ã‚’é”æˆã—ã€ä¿¡é ¼ã•ã‚Œã‚‹å­˜åœ¨ã¨ã—ã¦æˆåŠŸã‚’åã‚ã¾ã—ãŸã€‚",
                "å‰µé€ å‹ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆäººç”Ÿ": "ç‹¬è‡ªã®æ„Ÿæ€§ã§ä¸–ç•Œã‚’è¡¨ç¾ã—ã€äººã€…ã«æ„Ÿå‹•ã‚’ä¸ãˆã‚‹äººç”Ÿã§ã—ãŸã€‚",
                "ãƒãƒ©ãƒ³ã‚¹å‹å……å®Ÿäººç”Ÿ": "ä»•äº‹ã‚‚ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚‚å¤§åˆ‡ã«ã—ã€å¹¸ã›ãªäººç”Ÿã‚’ç¯‰ãã¾ã—ãŸã€‚",
                "è²¢çŒ®å‹ãƒªãƒ¼ãƒ€ãƒ¼äººç”Ÿ": "ä»–è€…ã®ãŸã‚ã«å°½ãã—ã€ç¤¾ä¼šã«å¤§ããªå½±éŸ¿ã‚’ä¸ãˆã¾ã—ãŸã€‚"
            };
            
            return analyses[lifeType] || "ã‚ãªãŸã¯è‡ªåˆ†ã‚‰ã—ã„ç´ æ™´ã‚‰ã—ã„äººç”Ÿã‚’æ­©ã¿ã¾ã—ãŸã€‚";
        }

        // ãƒªãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆ
        function generateRewards(lifePath) {
            const rewards = [
                { title: "ğŸ† ãƒ‘ã‚¤ã‚ªãƒ‹ã‚¢è³", description: "æ–°ã—ã„é“ã‚’åˆ‡ã‚Šé–‹ã„ãŸè¨¼" },
                { title: "ğŸ’ ç¶™ç¶šã¯åŠ›è³", description: "åŠªåŠ›ã‚’ç¶šã‘ãŸè¨¼" },
                { title: "ğŸŒŸ ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è³", description: "ä»–è€…ã«å½±éŸ¿ã‚’ä¸ãˆãŸè¨¼" }
            ];
            
            return rewards;
        }

        // ãƒãƒ¼ãƒˆãƒ†ã‚£ãƒƒãƒ—ã‚¹ç”Ÿæˆ
        function generateCheatTips(lifeType, gameState) {
            return [
                "å¤±æ•—ã‚’æã‚Œãšã«æŒ‘æˆ¦ã™ã‚‹ã“ã¨ã§ã€æ–°ã—ã„å¯èƒ½æ€§ãŒé–‹ã‘ã¾ã™",
                "äººã¨ã®å‡ºä¼šã„ã‚’å¤§åˆ‡ã«ã™ã‚‹ã“ã¨ã§ã€äººç”ŸãŒè±Šã‹ã«ãªã‚Šã¾ã™",
                "è‡ªåˆ†ã®ä¾¡å€¤è¦³ã‚’ä¿¡ã˜ã¦è¡Œå‹•ã™ã‚‹ã“ã¨ãŒã€å¹¸ã›ã¸ã®è¿‘é“ã§ã™",
                "ç¶™ç¶šçš„ãªå­¦ç¿’ã¨æˆé•·ãŒã€é•·æœŸçš„ãªæˆåŠŸã«ã¤ãªãŒã‚Šã¾ã™"
            ];
        }

        // PDFç”Ÿæˆ
        function downloadPDF() {
            showLoading();
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // ãƒ•ã‚©ãƒ³ãƒˆè¨­å®šï¼ˆæ—¥æœ¬èªå¯¾å¿œã¯å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§è¿½åŠ å®Ÿè£…å¿…è¦ï¼‰
            doc.setFont("helvetica");
            
            // è¡¨ç´™
            doc.setFontSize(24);
            doc.text("Life Path Journey", 105, 30, { align: "center" });
            doc.setFontSize(16);
            doc.text(gameState.user.name, 105, 50, { align: "center" });
            doc.text(new Date().toLocaleDateString(), 105, 60, { align: "center" });
            
            // äººç”Ÿã‚¿ã‚¤ãƒ—
            doc.setFontSize(14);
            doc.text("Life Type: " + gameState.summary.type, 20, 80);
            
            // åˆ†æ
            doc.setFontSize(12);
            const analysisLines = doc.splitTextToSize(gameState.summary.analysis, 170);
            doc.text(analysisLines, 20, 100);
            
            // æ–°ã—ã„ãƒšãƒ¼ã‚¸
            doc.addPage();
            
            // äººç”Ÿã®è»Œè·¡
            let yPosition = 20;
            gameState.lifePath.forEach((path, index) => {
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setFontSize(14);
                doc.text(`Stage ${index + 1}: ${path.scene}`, 20, yPosition);
                yPosition += 10;
                
                doc.setFontSize(12);
                doc.text(`Choice: ${path.choice}`, 20, yPosition);
                yPosition += 10;
                
                const commentLines = doc.splitTextToSize(path.comment, 170);
                doc.text(commentLines, 20, yPosition);
                yPosition += commentLines.length * 5 + 10;
            });
            
            // PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            doc.save(`life-path-${gameState.user.name}-${Date.now()}.pdf`);
            
            hideLoading();
        }

        // ã‚·ã‚§ã‚¢æ©Ÿèƒ½
        function shareResult() {
            // å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯ã‚·ã‚§ã‚¢ç”¨URLã‚’ç”Ÿæˆ
            const shareText = `ç§ã®äººç”Ÿã‚¿ã‚¤ãƒ—ã¯ã€Œ${gameState.summary.type}ã€ã§ã—ãŸï¼\näººç”Ÿåˆ†å²ä½“é¨“ã‚¢ãƒ—ãƒªã§ã€ã‚ãªãŸã‚‚åˆ¥ã®äººç”Ÿã‚’ä½“é¨“ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'äººç”Ÿåˆ†å²ä½“é¨“ - çµæœ',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
                navigator.clipboard.writeText(shareText + '\n' + window.location.href);
                alert('ã‚·ã‚§ã‚¢ç”¨ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
            }
        }

        // ã‚²ãƒ¼ãƒ ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ
        function restartGame() {
            gameState = {
                user: { name: "", lifeMood: "" },
                currentStage: 0,
                lifePath: [],
                summary: null
            };
            
            document.getElementById('resultScreen').style.display = 'none';
            document.getElementById('welcomeScreen').style.display = 'block';
            document.getElementById('userName').value = '';
        }

        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º/éè¡¨ç¤º
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        // åˆæœŸåŒ–
        window.onload = function() {
            // ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã§ã‚²ãƒ¼ãƒ é–‹å§‹
            document.getElementById('userName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    startGame();
                }
            });
        };
    </script>
</body>
</html>