# モヤモヤ言語化ナビゲーター

漠然とした思いや悩みを対話を通じて言葉にし、自己理解を深めて次の一歩につなげるAI対話システム

## プロジェクト概要

このプロジェクトは、子どもから大人まで誰もが抱える「将来への漠然とした不安」や「なんとなくのモヤモヤ」を、AI対話を通じて言語化し、具体的な行動や気づきにつなげることを目的とした自己変容支援システムです。

### コアコンセプト
- **「モヤモヤ」→「言語化」→「次の一歩」**のサイクル実現
- 段階的な深掘り対話による自己探究支援
- 会話履歴の蓄積による継続的な内省サポート
- 視覚的な可視化による自己理解の促進

## 技術仕様

### アーキテクチャ
- **フロントエンド**: HTML5, CSS3, Vanilla JavaScript
- **バックエンド**: 静的サイト（サーバーレス）
- **AI連携**: LLM API（外部サービス）
- **データ保存**: localStorage（ブラウザ内永続化）
- **可視化**: Canvas API

### ファイル構成
```
webtool_moyamoya2/
├── index.html          # メインUI（573行）
├── app.js             # アプリケーションロジック（1,044行）
├── 開発方針.txt        # プロジェクト設計思想
└── README.md          # このファイル
```

## 実装済み機能

### ✅ 高度な対話システム
- **段階的探究フェーズ**: initial → exploring → deepening → actionable
- **文脈認識対話**: 過去の会話を踏まえた継続性のある対話
- **重複回避機能**: 既に話し合ったトピックの自動判定
- **動的質問生成**: LLMによる文脈に応じた最適な質問提案

### ✅ 高度な分析・記憶システム
- **8カテゴリタグ分類**: career, study, relationship, future, anxiety, growth, value, action
- **3段階深度分析**: surface, medium, deep
- **タグ関連性マッピング**: テーマ間の繋がりを自動検出
- **会話パターン分析**: ユーザーの思考スタイル自動判定

### ✅ 可視化システム
- **感情マップ**: 時系列グラフ + 分布円グラフによる感情変化の可視化
- **思考マップ**: ノードベースの関連性可視化（タグ間の繋がり）
- **リアルタイム更新**: 会話に応じた動的な可視化更新

### ✅ パーソナライゼーション
- **思考スタイル判定**: 詳細型/簡潔型、前向き/慎重思考の自動分類
- **適応的対話**: ユーザーの特性に合わせた質問スタイル調整
- **継続性管理**: セッション間での文脈保持

### ✅ UI/UX機能
- **レスポンシブデザイン**: デスクトップ/タブレット/モバイル対応
- **タイピングインジケーター**: AI応答中の視覚的フィードバック
- **自動リサイズテキストエリア**: 入力内容に応じた動的サイズ調整
- **アクション提案**: 次の具体的ステップの提示

## 未実装・改善が必要な機能

### 🔄 中優先度の改善項目

#### データ管理の強化
- **エクスポート機能**: 会話履歴のJSONダウンロード
- **インポート機能**: 他デバイスからのデータ移行
- **バックアップ機能**: クラウドストレージ連携

#### 高度な分析機能
- **週次/月次レポート**: 自動的な振り返りサマリー生成
- **成長トラッキング**: 時系列での価値観・関心の変化追跡
- **目標設定支援**: SMART目標に基づく具体的計画立案

#### 共有・連携機能
- **結果共有**: 家族・友人・カウンセラーとの部分的データ共有
- **外部ツール連携**: カレンダーアプリ、タスク管理ツールとの連携

### 🔧 技術的改善項目

#### パフォーマンス最適化
- **レンダリング最適化**: Canvas描画の効率化
- **メモリ管理**: 大量会話履歴での性能維持
- **ローディング状態**: 初期表示の高速化

#### エラーハンドリング
- **ネットワークエラー対応**: オフライン時の優雅な劣化
- **API制限対応**: レート制限時の適切な制御
- **データ復旧機能**: 破損したlocalStorageからの回復

## 特定されたバグ・問題点

### 🐛 修正が必要なバグ

#### 1. キャンバス描画の初期化問題
**場所**: `app.js:662-696` (updateEmotionMap関数)
**問題**: DOMが完全に読み込まれる前にCanvas要素にアクセスしている可能性
**影響**: 初回表示時に可視化が正しく動作しない場合がある
**修正方法**: DOM要素の存在確認を強化し、null チェックを追加

#### 2. デバッグコードの残存
**場所**: `app.js:127` 
**問題**: `console.error('エラー:', error);` が本番環境に残存
**影響**: ブラウザコンソールにエラー情報が露出
**修正方法**: プロダクション用のエラーハンドリングに変更

#### 3. LocalStorage容量制限への対応不足
**場所**: `app.js:780-807` (saveConversationHistory関数)
**問題**: 大量データ蓄積時のlocalStorage容量オーバーへの対策不足
**影響**: 長期利用時にデータ保存ができなくなる可能性
**修正方法**: データ圧縮、古いデータの自動削除機能を実装

### ⚠️ 潜在的な問題

#### 4. AI API エラー時の代替処理不足
**場所**: `app.js:128-157` (generateAIResponse関数)
**問題**: API呼び出し失敗時の代替応答メカニズムが不十分
**影響**: ネットワーク障害時にユーザーエクスペリエンスが著しく低下
**修正方法**: 事前定義済み応答パターンの実装

#### 5. セキュリティ考慮事項
**場所**: HTML内のインラインスタイル全般
**問題**: Content Security Policy (CSP) 未対応
**影響**: XSS攻撃のリスク増加
**修正方法**: 外部CSSファイル化、CSPヘッダー設定

## UI/UX 改善提案

### 🎨 デザイン改善

#### 1. 視覚的階層の強化
- **キーワードクラウド**: より直感的なワードクラウド表示
- **進捗インジケーター**: 探究の深さをより分かりやすく可視化
- **テーマ別色分け**: カテゴリごとの一貫した色使い

#### 2. インタラクション改善
- **ショートカットキー**: Ctrl+Enter での送信、Esc でリセット等
- **音声入力対応**: Web Speech API を活用した音声テキスト変換
- **ダークモード**: 夜間利用時の目への配慮

#### 3. アクセシビリティ向上
- **スクリーンリーダー対応**: ARIA ラベルの適切な設定
- **キーボードナビゲーション**: Tab キーでの操作対応
- **高コントラストモード**: 視覚障害者向けの表示オプション

### 📱 モバイル体験の改善

#### 1. タッチ操作最適化
- **スワイプジェスチャー**: 左右スワイプでのパネル切り替え
- **プルトゥリフレッシュ**: 下方向スワイプでの再読み込み
- **ピンチズーム**: 可視化の拡大縮小操作

#### 2. レイアウト改善
- **折りたたみ式パネル**: 画面領域の効率的活用
- **フローティングアクションボタン**: 重要機能への素早いアクセス

## 開発・運用ガイド

### 🚀 セットアップ

```bash
# プロジェクトディレクトリに移動
cd webtool_moyamoya2

# 簡易HTTPサーバーで起動（Python）
python3 -m http.server 8080

# または Node.js の場合
npx serve .

# ブラウザでアクセス
# http://localhost:8080
```

### 🔧 設定

#### API設定
`app.js:131` の `apiUrl` を適切なLLM APIエンドポイントに変更してください。

```javascript
const apiUrl = 'YOUR_LLM_API_ENDPOINT';
```

#### カスタマイズ
- **色テーマ**: `index.html:9-22` の CSS変数を編集
- **キーワード辞書**: `app.js:301-334` の `keywordPatterns` を編集
- **可視化設定**: Canvas描画関数のパラメータを調整

### 📊 データ構造

#### LocalStorage キー
- `moyamoyaHistory`: セッション履歴データ
- `moyamoyaGlobalInsights`: グローバル分析データ

#### セッションデータ構造
```javascript
{
  sessionId: "session_1234567890_abc123",
  startTime: "2024-01-01T00:00:00.000Z",
  lastUpdate: "2024-01-01T01:00:00.000Z",
  history: [...],  // 会話履歴
  tags: [...],     // 抽出されたタグ
  themes: {...},   // テーマ分析データ
  depth: 5         // 会話の深さ
}
```

## 今後の開発ロードマップ

### フェーズ1: 安定性向上（優先度: 高）
- [ ] 特定されたバグの修正
- [ ] エラーハンドリングの強化
- [ ] パフォーマンス最適化

### フェーズ2: 機能拡張（優先度: 中）
- [ ] データエクスポート/インポート機能
- [ ] 週次/月次レポート機能
- [ ] 音声入力対応

### フェーズ3: 高度化（優先度: 低）
- [ ] クラウド同期機能
- [ ] 他者との共有機能
- [ ] AI モデルの選択機能

## ライセンス・クレジット

このプロジェクトは教育・研究目的で開発されました。
- Font Awesome: アイコンライブラリ
- モヤモヤ言語化ナビゲーター: オリジナル概念・実装

---

**最終更新**: 2024年1月
**バージョン**: v1.0.0-beta
**総行数**: 1,617行（HTML: 573行、JavaScript: 1,044行）