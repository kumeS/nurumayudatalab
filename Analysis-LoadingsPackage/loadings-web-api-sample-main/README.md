---
title: Loadings Web API Sample
emoji: ğŸš€
colorFrom: gray
colorTo: indigo
sdk: docker
pinned: false
license: mit
---

# Loadings Web API ã‚µãƒ³ãƒ—ãƒ«

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰ã®å› å­è² è·é‡æ¤œå®šã‚’è¡Œã†Web APIã§ã™ã€‚Rè¨€èªã®loadingsãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨plumberãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ã€çµ±è¨ˆè§£æã‚’Web APIçµŒç”±ã§å®Ÿè¡Œã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚

### ä¸»ãªæ©Ÿèƒ½

- **CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒ¼ã‚¿ã®è§£æãŒå¯èƒ½
- **ä¸»æˆåˆ†åˆ†æ (PCA)**: ãƒ‡ãƒ¼ã‚¿ã®æ¬¡å…ƒå‰Šæ¸›ã¨å¯è¦–åŒ–
- **å› å­è² è·é‡æ¤œå®š**: çµ±è¨ˆçš„æœ‰æ„æ€§ã®è©•ä¾¡
- **ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**: è§£æçµæœã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³**: biplotã€å› å­è² è·é‡åˆ†å¸ƒã€på€¤åˆ†å¸ƒã®ç”Ÿæˆ

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### æ–¹æ³•1: Nixç’°å¢ƒã‚’åˆ©ç”¨

Nixã‚’ä½¿ç”¨ã—ãŸç’°å¢ƒæ§‹ç¯‰ï¼š

> [!WARNING]
> NixãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```sh
# ç’°å¢ƒæ§‹ç¯‰
nix-shell

# Web APIèµ·å‹•
cd src
Rscript api-integrated.R
```

### æ–¹æ³•2: Dockerç’°å¢ƒã‚’åˆ©ç”¨

```sh
# Docker Composeã§ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•
docker-compose up -d
```

## API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä»•æ§˜

### ãƒ™ãƒ¼ã‚¹URL
- ãƒ­ãƒ¼ã‚«ãƒ«: `http://127.0.0.1:7860`
- Hugging Face Spaces: `https://myxogastria0808-loadings-web-api-sample.hf.space`

### 1. ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

#### CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
```
POST /upload/csv
Content-Type: multipart/form-data

Parameters:
- file: CSVãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå¿…é ˆï¼‰

Response:
- data_id: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®è­˜åˆ¥å­
- data_summary: ãƒ‡ãƒ¼ã‚¿ã®åŸºæœ¬çµ±è¨ˆæƒ…å ±
```

#### ãƒ‡ãƒ¼ã‚¿è¦ç´„çµ±è¨ˆå–å¾—
```
GET /data/summary/{data_id}
POST /data/summary

Response:
- ãƒ‡ãƒ¼ã‚¿ã®æ¬¡å…ƒã€åˆ—åã€åŸºæœ¬çµ±è¨ˆé‡
- ç›¸é–¢è¡Œåˆ—
- ãƒ‡ãƒ¼ã‚¿å“è³ªè©•ä¾¡
```

### 2. PCAè§£æ

#### ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒ¼ã‚¿ã§PCAå®Ÿè¡Œ
```
POST /analyze/pca-custom

Parameters:
- data_id: ãƒ‡ãƒ¼ã‚¿è­˜åˆ¥å­ï¼ˆå¿…é ˆï¼‰
- scale: ãƒ‡ãƒ¼ã‚¿æ¨™æº–åŒ–ãƒ•ãƒ©ã‚°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: trueï¼‰
- center: ãƒ‡ãƒ¼ã‚¿ä¸­å¿ƒåŒ–ãƒ•ãƒ©ã‚°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: trueï¼‰

Response:
- biplotç”»åƒï¼ˆBase64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼‰
- ä¸»æˆåˆ†åˆ¥ã®å› å­è² è·é‡ãƒ»på€¤ãƒ—ãƒ­ãƒƒãƒˆ
- å¯„ä¸ç‡ã€å›ºæœ‰å€¤ãªã©ã®çµ±è¨ˆæƒ…å ±
```

#### å› å­è² è·é‡åˆ†æ
```
POST /analyze/correlation-custom/{component}

Parameters:
- data_id: ãƒ‡ãƒ¼ã‚¿è­˜åˆ¥å­
- component: ä¸»æˆåˆ†ç•ªå·ï¼ˆ1-10ï¼‰

Response:
- å› å­è² è·é‡åˆ†å¸ƒãƒ—ãƒ­ãƒƒãƒˆ
- ä¸Šä½ãƒ»ä¸‹ä½å¤‰æ•°ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°
```

#### på€¤åˆ†æ
```
POST /analyze/pvalue-custom/{component}

Parameters:
- data_id: ãƒ‡ãƒ¼ã‚¿è­˜åˆ¥å­
- component: ä¸»æˆåˆ†ç•ªå·ï¼ˆ1-10ï¼‰

Response:
- på€¤åˆ†å¸ƒãƒ—ãƒ­ãƒƒãƒˆ
- çµ±è¨ˆçš„æœ‰æ„æ€§ã®è©³ç´°æƒ…å ±
```

### 3. å¾“æ¥ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿è§£æ

#### PCA Biplotç”Ÿæˆ
```
GET /pca

Response: PNGç”»åƒï¼ˆ800x800pxï¼‰
ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆfastingï¼‰ã‚’ä½¿ç”¨ã—ãŸbiplot
```

#### å› å­è² è·é‡åˆ†å¸ƒ
```
GET /correlation-coefficien/{number}

Parameters:
- number: ä¸»æˆåˆ†ç•ªå·ï¼ˆ1-10ã®æ•´æ•°ï¼‰

Response: PNGç”»åƒï¼ˆ800x800pxï¼‰
æŒ‡å®šã—ãŸä¸»æˆåˆ†ã®å› å­è² è·é‡åˆ†å¸ƒãƒãƒ¼ãƒ—ãƒ­ãƒƒãƒˆ
```

#### på€¤åˆ†å¸ƒ
```
GET /p-value/{number}

Parameters:
- number: ä¸»æˆåˆ†ç•ªå·ï¼ˆ1-10ã®æ•´æ•°ï¼‰

Response: PNGç”»åƒï¼ˆ800x800pxï¼‰
æŒ‡å®šã—ãŸä¸»æˆåˆ†ã®på€¤åˆ†å¸ƒãƒãƒ¼ãƒ—ãƒ­ãƒƒãƒˆ
```

### 4. ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

#### ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
```
GET /export/data/{data_id}

Parameters:
- include_analysis: è§£æçµæœã‚’å«ã‚€ã‹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

Response: CSVå½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«
```

#### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
```
GET /health

Response:
- APIã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
- åˆ©ç”¨å¯èƒ½æ©Ÿèƒ½ä¸€è¦§
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±
```

#### è§£æçµæœå–å¾—
```
GET /results/{analysis_id}

Response: æŒ‡å®šã—ãŸè§£æIDã®è©³ç´°çµæœ
```

## æŠ€è¡“ä»•æ§˜

### ä½¿ç”¨æŠ€è¡“
- **R**: çµ±è¨ˆè§£æã‚¨ãƒ³ã‚¸ãƒ³
- **plumber**: Web APIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **loadings**: å› å­è² è·é‡æ¤œå®šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
- **Docker**: ã‚³ãƒ³ãƒ†ãƒŠåŒ–
- **Nix**: å†ç¾å¯èƒ½ãªé–‹ç™ºç’°å¢ƒ

### ãƒ‡ãƒ¼ã‚¿å‡¦ç†
- CSVå½¢å¼ã®ãƒ‡ãƒ¼ã‚¿è‡ªå‹•æ¤œè¨¼
- æ¬ æå€¤ã®è‡ªå‹•å‡¦ç†
- æ•°å€¤ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•æŠ½å‡º
- å¤–ã‚Œå€¤æ¤œå‡ºã¨ãƒ¬ãƒãƒ¼ãƒˆ

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½
- CORSå¯¾å¿œ
- ä¸€æ™‚ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆ24æ™‚é–“ï¼‰
- ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼æ¤œè¨¼

## Swagger UI

APIä»•æ§˜æ›¸ã¨ãƒ†ã‚¹ãƒˆç’°å¢ƒï¼š
- ãƒ­ãƒ¼ã‚«ãƒ«: `http://127.0.0.1:7860/__docs__/#/`
- Hugging Face Spaces: `https://myxogastria0808-loadings-web-api-sample.hf.space/__docs__/#/`

![Swagger UI](https://github.com/user-attachments/assets/1eab9119-daf5-43fc-9418-3dacc7bded11)

## ä½¿ç”¨ä¾‹

### 1. CSVãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦PCAè§£æ

```bash
# 1. CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
curl -X POST -F "file=@data.csv" http://127.0.0.1:7860/upload/csv

# 2. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®data_idã‚’ä½¿ç”¨ã—ã¦PCAå®Ÿè¡Œ
curl -X POST -d '{"data_id":"data_20240101_120000_1234"}' \
  -H "Content-Type: application/json" \
  http://127.0.0.1:7860/analyze/pca-custom
```

### 2. ç‰¹å®šã®ä¸»æˆåˆ†ã®å› å­è² è·é‡åˆ†æ

```bash
curl -X POST -d '{"data_id":"data_20240101_120000_1234"}' \
  -H "Content-Type: application/json" \
  http://127.0.0.1:7860/analyze/correlation-custom/1
```

## å‚è€ƒè³‡æ–™

- [R plumberå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://www.rplumber.io/articles/rendering-output.html)
- [loadingsãƒ‘ãƒƒã‚±ãƒ¼ã‚¸](https://cran.r-project.org/package=loadings)
- [ä¸»æˆåˆ†åˆ†æã®ç†è«–](https://ja.wikipedia.org/wiki/ä¸»æˆåˆ†åˆ†æ)
