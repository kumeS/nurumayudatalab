# クイズ自動作成ツール 開発方針

## プロジェクト概要
LLMを活用した学習支援ツール。音声入力対応のクイズ自動生成システム。

## 修正箇所

### 新仕様：全問同時表示クイズシステム ✅ 実装完了
1. **全問同時表示**: 3問または5問すべてを同時に表示するUIに変更 ✅
2. **ヒント機能**: 各問題にヒントボタンを設置、使用すると採点が0.5点に減点 ✅
3. **一括採点**: 全問回答後に「回答する」ボタンで一括採点実行 ✅
4. **詳細フィードバック**: 間違いには理由とアドバイス表示 ✅
5. **再テスト機能**: 間違いを修正して再挑戦可能 ✅
6. **段階的演出**: 正解数に応じた全画面アニメーション表示 ✅
   - 100%: 虹色紙吹雪 + 金メダル演出 ✅
   - 80%以上: 青色紙吹雪 + 銀メダル演出 ✅
   - 60%以上: 緑色紙吹雪 + 銅メダル演出 ✅
   - 40%以上: オレンジ色応援演出 ✅
   - 40%未満: 励ましメッセージ演出 ✅

### 実装詳細
- **UI変更**: 1問ずつ表示から全問同時表示カード形式に変更
- **採点システム**: ヒント使用時0.5点、通常1点の加点方式
- **インタラクション**: 回答選択→一括採点→詳細フィードバック→再テスト
- **視覚的フィードバック**: 正解は緑、不正解は赤、ヒント使用は黄色でカード表示
- **演出バリエーション**: 得点率に応じた5段階の祝福アニメーション

作成したクイズは3つあるいは5つが同時に表示されるようにUIを変更する。
各問題にヒントボタンを設置して、押すとヒントが表示されるが、採点が0.5点になる。
全て回答すると、回答するボタンが押せて、採点が行われる。
間違ったら、なぜ間違ったかのアドバイスも表示される。再テストを行える。
全問正解だけはなくて、正解数に応じて、全画面で、アニメーションが表示されるようにして。

サンプルテキストデータが理科に偏っていると思われるので、国数英理社の課題を1つずつ、5つのサンプルをそれぞれのレベルで作成して。

## サンプルテキスト機能拡張 ✅ 実装完了

### 5教科対応サンプルテキスト
各学習レベルで国語・数学・英語・理科・社会の5教科のサンプルを提供：

#### 小学生（低学年）
1. **国語**: ひらがな・カタカナ・漢字の基礎
2. **数学**: 数字と基本的な計算（足し算・引き算）
3. **英語**: アルファベットと基本的な挨拶
4. **理科**: 太陽と昼夜の概念
5. **社会**: 家族と地域社会の基礎

#### 小学生（中学年）
1. **国語**: 物語の構造と登場人物の心情理解
2. **数学**: かけ算・わり算と九九
3. **英語**: 基本的な文構造（主語・動詞）
4. **理科**: 植物の構造と光合成
5. **社会**: 都道府県と地域の特色

#### 小学生（高学年）
1. **国語**: 敬語の種類と使い分け
2. **数学**: 分数・小数の概念と計算
3. **英語**: 時制（現在・過去・未来）
4. **理科**: 地球の自転・公転と季節変化
5. **社会**: 三権分立と民主主義の基礎

#### 中学生
1. **国語**: 古典文学（源氏物語・平家物語）
2. **数学**: 一次関数とグラフ
3. **英語**: 関係代名詞と複文構造
4. **理科**: 光合成の詳細メカニズム
5. **社会**: 江戸時代の政治制度と文化

#### 高校生
1. **国語**: 夏目漱石「こころ」の文学的分析
2. **数学**: 微分の定義と応用
3. **英語**: 仮定法の用法とニュアンス
4. **理科**: DNA構造と遺伝情報
5. **社会**: グローバル化の影響と課題

### 機能仕様
- **循環表示**: 各レベルで5つのサンプルを順番に表示
- **教科表示**: ボタンフィードバックで現在の教科名を表示
- **レベル連動**: 学習レベル変更時にサンプルインデックスをリセット
- **視覚的フィードバック**: 入力完了時のハイライト効果

### 教育的配慮
- **段階的難易度**: 各レベルに適した語彙と概念
- **教科バランス**: 文系・理系の均等な配分
- **実用性**: 実際の学習内容に即したテキスト
- **多様性**: 異なる分野での思考力育成

## 基本仕様

### デザイン基準
- index.htmlのデザインを参考にした統一感のあるUI
- レスポンシブデザイン対応
- 現代的なグラデーション効果とアニメーション
- 直感的で使いやすいインターフェース

### 学習レベル設定
- 小学生（低学年・中学年・高学年）
- 中学生
- 高校生
各レベルに応じた適切な難易度のクイズを生成

### クイズ設定
- **問題数**: 3問 または 5問
- **形式**: 2択（はい・いいえ）、3択、4択
- **難易度**: 学習レベルに自動調整

## 主要機能

### 1. 音声入力機能 ✅ 実装済み
- Web Speech APIによる音声認識
- 開始・一時停止・再開・停止の完全制御
- リアルタイム文字起こし
- 既存テキストへの追記対応

### 2. サンプルテキスト機能 ✅ 実装済み
- 各学習レベルに3つずつのサンプルテキスト（計15個）
- サンプルボタンで循環切り替え
- 学習レベル変更時のインデックスリセット
- **重要**: 学習レベル変更時に入力エリアの内容は保持される

### 3. テキスト入力・編集機能 ✅ 実装済み
- 自由なテキスト入力・編集
- 自動保存機能（localStorage）
- 音声入力との併用可能
- ハイライト効果による視覚的フィードバック

### 4. クイズ生成機能 ✅ 実装済み
- **LLMモデル**: meta-llama/Llama-4-Maverick-17B-128E-Instruct-FP8
- **API エンドポイント**: https://nurumayu-worker.skume-bioinfo.workers.dev/
- 学習レベルに応じた適切な難易度調整
- JSON形式でのクイズデータ生成
- エラーハンドリング完備
- 動的プロンプト生成による高品質なクイズ作成

### 5. バリエーション向上機能 ✅ 実装済み
- **段階的問題レベル変化**:
  - 1回目: 基本的な理解確認
  - 2回目: 応用的思考力
  - 3回目: 創造的・発展的問題
  - 4回目: 総合的理解力
  - 5回目以降: 多角的視点
- **重複回避システム**: 過去5回分の履歴管理
- **動的パラメータ調整**: temperatureの段階的上昇
- **生成回数表示**: ボタンに「○回目・○○モード」表示

### 6. インタラクティブクイズ機能 ✅ 実装済み
- 問題表示とプログレス管理
- 選択肢のクリック選択
- **ヒント機能**: 初回間違い時にヒント表示、再回答可能
- **解説機能**: 正解時に詳細解説表示
- スコア管理とリアルタイム表示

### 7. 祝福演出機能 ✅ 実装済み
- 全問正解時のフルスクリーン祝福演出
- 紙吹雪アニメーション（10個のカラフル要素）
- キラキラ効果（星とスパークル）
- Web Audio APIによる効果音（C-E-G和音）
- 美しいグラデーション背景とガラス効果

### 8. UI/UX機能 ✅ 実装済み
- 使い方ガイドの折りたたみ表示
- クイズデータの折りたたみ表示
- コピー機能
- リセット機能（履歴も含む完全リセット）
- ローディングインジケーター

## 技術仕様

### フロントエンド
- **HTML5**: セマンティックマークアップ
- **CSS3**: モダンなスタイリング、アニメーション
- **JavaScript (ES6+)**: 非同期処理、DOM操作

### API連携
- **LLM API**: https://nurumayu-worker.skume-bioinfo.workers.dev/
  - モデル: meta-llama/Llama-4-Maverick-17B-128E-Instruct-FP8
  - Temperature: 0.7-1.0（動的調整）
  - Max tokens: 2000
  - Stream: false
- **Web Speech API**: 音声認識
- **Web Audio API**: 効果音生成

### データ管理
- **localStorage**: テキスト自動保存
- **メモリ管理**: クイズ生成履歴（最大5回分）

## LLMカスタムインストラクション詳細

### システムプロンプト構造
クイズ生成時に以下の要素を動的に組み合わせてプロンプトを構築：

#### 1. 基本指示
```
あなたはクイズ作成の専門家です。与えられたテキストから{学習レベル}レベルの{クイズ形式}を{問題数}問作成してください。
```

#### 2. バリエーション指示（生成回数に応じて変化）
- **1回目**: 基本的な理解を確認する問題を中心に作成
- **2回目**: 応用的な思考力を問う問題を含める、前回とは異なる角度から問題を作成
- **3回目**: 創造的で発展的な問題を作成、実生活への応用や関連事例を考えさせる
- **4回目**: 総合的な理解力を測る問題、複数の概念を組み合わせた批判的思考を促す
- **5回目以降**: 多角的な視点から問題を作成、異なる文脈での考察や比較・対比を求める

#### 3. 焦点領域指示（段階的変化）
- **1回目**: 事実確認、基本概念の理解
- **2回目**: 因果関係、プロセスの理解、比較・対比
- **3回目**: 応用・実践、問題解決、創造的思考
- **4回目**: 分析・評価、批判的思考、統合的理解
- **5回目以降**: 多面的分析、関連性の発見、発展的思考

#### 4. 問題スタイル指示（段階的変化）
- **1回目**: 直接的で明確な問題文を使用
- **2回目**: 「なぜ」「どのように」を含む問題文を積極的に使用
- **3回目**: 具体例や事例を含む問題文を作成
- **4回目**: 仮定や条件を含む問題文を作成
- **5回目以降**: 複数の要素を組み合わせた複合的な問題文を作成

#### 5. 重複回避指示
過去5回分の生成履歴から主要キーワードを抽出し、異なる視点や表現の使用を指示

#### 6. 出力形式指示
```json
{
  "questions": [
    {
      "question": "問題文",
      "options": ["選択肢1", "選択肢2", ...],
      "correct": 0,
      "hint": "間違えた時のヒント",
      "explanation": "正解時の解説"
    }
  ]
}
```

#### 7. 品質保証指示
- 学習レベルに適した難易度の維持
- correctは正解選択肢のインデックス（0から始まる）
- 2択問題では「はい」「いいえ」形式を基本とする
- ヒントは理解を助ける内容
- 解説は正解の理由を分かりやすく説明
- JSON形式での厳密な出力
- 前回と異なる視点や角度からの問題作成

### パラメータ調整戦略
- **Temperature**: 0.7（基本）→ 1.0（最大）まで生成回数に応じて段階的上昇
- **バリエーション向上**: 生成回数 × 0.1の増加値（最大0.3まで）
- **創造性向上**: 2回目以降で徐々にランダム性を増加

## ファイル構成

### 対象ファイル
- `index.html`: メインHTML、UI構造、CSS
- `app.js`: JavaScript、全機能の実装

### 実装状況: 100% 完了 ✅

## 完了済み機能一覧

### 基本機能
- [x] 音声録音・文字起こし機能
- [x] サンプルテキスト機能（各レベル3つずつ）
- [x] 学習レベル選択（5段階）
- [x] クイズ設定（問題数・形式選択）
- [x] テキスト入力・編集・保存

### クイズ生成・実行
- [x] LLM APIによるクイズ自動生成
- [x] 動的プロンプト生成システム
- [x] バリエーション向上機能（5段階）
- [x] 重複回避システム
- [x] インタラクティブクイズ実行
- [x] ヒント・解説システム
- [x] スコア管理・プログレス表示

### UI/UX
- [x] レスポンシブデザイン
- [x] 現代的なボタンデザイン
- [x] アニメーション効果
- [x] 祝福演出（全問正解時）
- [x] 折りたたみ式ガイド・データ表示

### 品質・保守性
- [x] エラーハンドリング
- [x] メモリ管理
- [x] ブラウザ互換性
- [x] アクセシビリティ配慮

## LLMプロンプトエンジニアリング詳細

### 実装されたプロンプト戦略
1. **コンテキスト適応型プロンプト**: 学習レベルに応じた語彙・概念の調整
2. **段階的複雑化**: 生成回数に応じた問題の深度向上
3. **多様性確保**: 過去履歴を活用した重複回避
4. **品質制御**: 構造化された出力形式の強制
5. **創造性向上**: 動的temperature調整による柔軟性確保

### プロンプト最適化技術
- **Few-shot Learning**: 暗黙的な例示による品質向上
- **Chain of Thought**: 段階的思考プロセスの誘導
- **Constraint Programming**: JSON形式出力の厳密な制御
- **Dynamic Prompting**: 実行時コンテキストに応じた指示調整

## 今後の拡張可能性

### 機能拡張案
- 問題の難易度自動調整（適応学習）
- 学習履歴の永続化（データベース連携）
- 複数言語対応（多言語プロンプト）
- 画像・図表を含むクイズ（マルチモーダル）
- 学習分析・レポート機能（学習効果測定）
- カスタムプロンプトテンプレート機能

### 技術改善案
- PWA対応（オフライン学習）
- リアルタイム協調学習
- パフォーマンス最適化（キャッシュ戦略）
- セキュリティ強化（API認証）
- A/Bテスト機能（プロンプト効果測定）

## 開発完了宣言

本プロジェクトは開発方針に基づく全機能の実装が完了しました。
音声入力からクイズ生成、インタラクティブな学習体験まで、
包括的な学習支援ツールとして機能しています。

**最終更新**: 2024年12月
**ステータス**: 開発完了 ✅
**LLMモデル**: meta-llama/Llama-4-Maverick-17B-128E-Instruct-FP8
**プロンプトエンジニアリング**: 動的多段階システム実装済み





