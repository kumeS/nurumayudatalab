<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>キーワード整形ツール</title>
  <style>
    body   { font-family: system-ui, sans-serif; margin: 2rem; }
    textarea { width: 100%; height: 8rem; }
    button   { margin-top: 1rem; padding: .4rem 1rem; font-size: 1rem; }
    /* ▼★ モーダル用スタイル */
    #modal {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }
    #modalContent {
      position: absolute;
      top: 10%; left: 10%; right: 10%;
      background: #fff;
      padding: 2rem;
      border-radius: 8px;
      overflow-y: auto;
    }
    #modal textarea {
      width: 100%; height: 8rem;
    }
    #modal button {
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>キーワード整形ツール</h1>

  <p>半角スペース区切りでキーワードを入力し、<strong>実行</strong>をクリックしてください。</p>
  <textarea id="kwInput" placeholder="例: パンプス レディース ローヒール パンプス 幅広 ..."></textarea><br>
  <button id="execBtn">実行</button>

  <!-- ▼★ モーダル追加 -->
  <div id="modal">
    <div id="modalContent">
      <h2>重複削除後のキーワード</h2>
      <textarea readonly id="resultText"></textarea><br>

      <h3>▼ クリック 2：所定バイト数ごとに改行</h3>
      <button onclick="splitAndShow(250)">250 バイト単位に分割</button>
      <button onclick="splitAndShow(500)">500 バイト単位に分割</button>
      <button onclick="spaceToNewline()">スペース区切りを改行に変換</button>

      <pre id="outArea"></pre>
      <button onclick="closeModal()">閉じる</button>
    </div>
  </div>

  <script>
  // ▼ クリック 1：重複除去してモーダル表示
  document.getElementById('execBtn').addEventListener('click', () => {
    const raw = document.getElementById('kwInput').value.trim();
    if (!raw) { alert('キーワードを入力してください'); return; }

    // 重複除去（元の並び順を保持）
    const uniq = [];
    const seen = new Set();
    raw.split(/\s+/).forEach(w => {
      if (!seen.has(w)) { seen.add(w); uniq.push(w); }
    });
    const result = uniq.join(' ');

    // モーダルに表示
    document.getElementById('resultText').value = result;
    document.getElementById('modal').style.display = 'block';
  });

  // ▼ モーダルを閉じる
  function closeModal() {
    document.getElementById('modal').style.display = 'none';
    document.getElementById('outArea').textContent = '';
  }

  // ▼ 250 / 500 バイト単位で分割
  function byteLen(s) { return new TextEncoder().encode(s).length; }
  
  function splitAndShow(maxBytes) {
    const words = document.getElementById('resultText').value.split(' ');
    const lines = [];
    let current = '';

    words.forEach(w => {
      const test = current ? current + ' ' + w : w;
      if (byteLen(test) <= maxBytes) {
        current = test;
      } else {
        if (current) lines.push(current);
        current = w;
      }
    });
    if (current) lines.push(current);
    document.getElementById('outArea').textContent = lines.join('\n');
  }

  // ▼ 半角スペースで改行
  function spaceToNewline() {
    const converted = document.getElementById('resultText').value.split(' ').join('\n');
    document.getElementById('outArea').textContent = converted;
  }
  </script>
</body>
</html>
